

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Lesson 15: Tidy data and split-apply-combine &mdash; Programming Bootcamp  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lesson 16: Making plots" href="l16_plotting.html" />
    <link rel="prev" title="Lesson 14: Introduction to Pandas" href="l14_intro_to_pandas.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #F1F2D8" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Lessons</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="l00_configuring_your_computer.html">Lesson 0: Configuring your computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="l01_welcome.html">Lesson 1: Welcome and Introduction to JupyterLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="l02_basic_command_line_skills.html">Lesson 2: Basic command line skills</a></li>
<li class="toctree-l1"><a class="reference internal" href="l03_variables_operators_types.html">Lesson 3: Variables, operators, and types</a></li>
<li class="toctree-l1"><a class="reference internal" href="l04_more_operators_and_conditionals.html">Lesson 4: More operators and conditionals</a></li>
<li class="toctree-l1"><a class="reference internal" href="l05_lists_and_tuples.html">Lesson 5: Lists and tuples</a></li>
<li class="toctree-l1"><a class="reference internal" href="l06_iteration.html">Lesson 6: Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="l07_intro_to_functions.html">Lesson 7: Introduction to functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="l08_string_methods.html">Lesson 8: String methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="l09_dictionaries.html">Lesson 9: Dictionaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="l10_packages_and_modules.html">Lesson 10: Packages and modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="l11_style.html">Lesson 11: Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="l12_file_io.html">Lesson 12: File I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="l13_intro_to_oop.html">Lesson 13: Introduction to object-oriented programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="l14_intro_to_pandas.html">Lesson 14: Introduction to Pandas</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lesson 15: Tidy data and split-apply-combine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Tidy-data">Tidy data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-data-set">The data set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Split-apply-combine">Split-apply-combine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Aggregation:-Median-percent-correct">Aggregation: Median percent correct</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Transformation">Transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Aggregating-and-transforming-with-custom-functions">Aggregating and transforming with custom functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Looping-over-a-GroupBy-object">Looping over a GroupBy object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Tidying-a-data-set">Tidying a data set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Computing-environment">Computing environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l16_plotting.html">Lesson 16: Making plots</a></li>
<li class="toctree-l1"><a class="reference internal" href="l17_intro_to_numpy_and_scipy.html">Lesson 17: Introduction to Numpy and Scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="l18_version_control_with_git.html">Lesson 18: Version control with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="l19_exceptions_and_error_handling.html">Lesson 19: Errors and Exception handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="l20_testing_and_tdd.html">Lesson 20: Testing and test-driven development</a></li>
<li class="toctree-l1"><a class="reference internal" href="l21_examples_of_tdd.html">Lesson 21: Examples of TDD</a></li>
<li class="toctree-l1"><a class="reference internal" href="l22_high_level_plotting.html">Lesson 22: High level plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="l23_plotting_time_series_generated_data.html">Lesson 23: Plotting time series and generated data</a></li>
<li class="toctree-l1"><a class="reference internal" href="l24_intro_to_scripting.html">Lesson 24: Introduction to scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="l25_other_packages_and_languages.html">Lesson 25: Survey of other packages and languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="l26_bootcamp_recap.html">Lesson 26: Bootcamp recap</a></li>
</ul>
<p class="caption"><span class="caption-text">Schedule</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">Schedule overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html#daily-schedule-all-times-pdt">Daily schedule (all times PDT)</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Scientific Python distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html#online-instruction">Online instruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html#books">Books</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Programming Bootcamp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Lesson 15: Tidy data and split-apply-combine</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/lessons/l15_split_apply_combine.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Lesson-15:-Tidy-data-and-split-apply-combine">
<h1>Lesson 15: Tidy data and split-apply-combine<a class="headerlink" href="#Lesson-15:-Tidy-data-and-split-apply-combine" title="Permalink to this headline">¶</a></h1>
<hr><div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
<hr><p>In the <a class="reference internal" href="l14_intro_to_pandas.html"><span class="doc">last lesson</span></a>, we learned about Pandas and dipped our toe in to see its power. In this lesson, we will continue to harness the power of Pandas to pull out subsets of data we are interested in.</p>
<div class="section" id="Tidy-data">
<h2>Tidy data<a class="headerlink" href="#Tidy-data" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Hadley_Wickham">Hadley Wickham</a> wrote a <a class="reference external" href="http://dx.doi.org/10.18637/jss.v059.i10">great article</a> in favor of “tidy data.” Tidy data frames follow the rules:</p>
<ol class="arabic simple">
<li><p>Each variable is a column.</p></li>
<li><p>Each observation is a row.</p></li>
<li><p>Each type of observation has its own separate data frame.</p></li>
</ol>
<p>This is less pretty to visualize as a table, but we rarely look at data in tables. Indeed, the representation of data which is convenient for visualization is different from that which is convenient for analysis. A tidy data frame is almost always <strong>much</strong> easier to work with than non-tidy formats.</p>
<p>You may raise some objections about tidy data. Here are a few, and my responses.</p>
<p><strong>Objection:</strong> Looking at a table of tidy data is ugly. It is not intuitively organized. I would almost never display a tidy data table in a publication.</p>
<p><strong>Response:</strong> Correct! Having tabular data in a format that is easy to read as a human studying a table is a very different thing than having it in a format that is easy to explore and work with using a computer. As <a class="reference external" href="https://chendaniely.github.io">Daniel Chen</a> put it, “There are data formats that are better for reporting and data formats that are better for analysis.” We are using the tidy data frames for analysis, not reporting (though we will see in the coming lessons that having the data
in a tidy format makes making plots much easier, and plots are a key medium for reporting.)</p>
<p><strong>Objection:</strong> Isn’t it better to sometimes have data arranged in other ways? Say in a matrix?</p>
<p><strong>Response:</strong> This is certainly true for things like images, or raster-style data in general. It makes more sense to organize an image in a 2D matrix than to have it organized as a data frame with three columns (row in image, column in image, intensity of pixel), where each row corresponds to a single pixel. For an image, indexing it by row and column is always unambiguous, <code class="docutils literal notranslate"><span class="pre">my_image[i,</span> <span class="pre">j]</span></code> means the pixel at row <code class="docutils literal notranslate"><span class="pre">i</span></code> and column <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p>
<p>For other data, though, the matrix layout suffers from the fact that there may be more than one way to construct a matrix. If you know a data frame is tidy, you already know its structure. You need only to ask what the columns are, and then you immediately know how to access data using Boolean indexing. In other formats, you might have to read and write extensive comments to understand the structure of the data. Of course, you <em>can</em> read and write comments, but it opens the door for the
possibility of misinterpretation or mistakes.</p>
<p><strong>Objection:</strong> But what about time series? Clearly, that can be in matrix format. One column is time, and then subsequent columns are observations made at that time.</p>
<p><strong>Response:</strong> Yes, that is true. But then the matrix-style described could be considered tidy, since each row is a single observation (time point) that has many facets.</p>
<p><strong>Objection:</strong> Isn’t this an inefficient use of memory? There tend to be lots of repeated entries in tidy data frames.</p>
<p><strong>Response:</strong> Yes, there are more efficient ways of storing and accessing data. But for data sets that are not “big data,” this is seldom a real issue. The extra expense in memory, as well as the extra expense in access, are small prices to pay for the simplicity and speed of the human user in accessing the data.</p>
<p><strong>Objection:</strong> Once it’s tidy, we pretty much have to use Boolean indexing to get what we want, and that can be slower than other methods of accessing data. What about performance?</p>
<p><strong>Response:</strong> See the previous response. Speed of access really only becomes a problem with big, high-throughput data sets. In those cases, there are often many things you need to be clever about beyond organization of your data.</p>
<p><strong>Conclusion:</strong> I really think that tidying a data set allows for fluid exploration. We will focus on tidy data sets going forward. The techniques for bringing untidy data into tidy format use many of Pandas’s functions, but are largely beyond the scope of this bootcamp. You will explore that a little bit in the exercises, but for most of the bootcamp, our data sets are already tidy.</p>
</div>
<div class="section" id="The-data-set">
<h2>The data set<a class="headerlink" href="#The-data-set" title="Permalink to this headline">¶</a></h2>
<p>We will again use the data set from the <a class="reference external" href="https://doi.org/10.1098/rsos.160321">Beattie, et al. paper</a> on facial matching under sleep deprivation. Let’s load in the original data set and add the column on insomnia as we did in the <a class="reference internal" href="l14_intro_to_pandas.html"><span class="doc">last lesson</span></a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/gfmt_sleep.csv&#39;</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;insomnia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sci&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">16</span>

<span class="c1"># Take a look</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant number</th>
      <th>gender</th>
      <th>age</th>
      <th>correct hit percentage</th>
      <th>correct reject percentage</th>
      <th>percent correct</th>
      <th>confidence when correct hit</th>
      <th>confidence when incorrect hit</th>
      <th>confidence when correct reject</th>
      <th>confidence when incorrect reject</th>
      <th>confidence when correct</th>
      <th>confidence when incorrect</th>
      <th>sci</th>
      <th>psqi</th>
      <th>ess</th>
      <th>insomnia</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8</td>
      <td>f</td>
      <td>39</td>
      <td>65</td>
      <td>80</td>
      <td>72.5</td>
      <td>91.0</td>
      <td>90.0</td>
      <td>93.0</td>
      <td>83.5</td>
      <td>93.0</td>
      <td>90.0</td>
      <td>9</td>
      <td>13</td>
      <td>2</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16</td>
      <td>m</td>
      <td>42</td>
      <td>90</td>
      <td>90</td>
      <td>90.0</td>
      <td>75.5</td>
      <td>55.5</td>
      <td>70.5</td>
      <td>50.0</td>
      <td>75.0</td>
      <td>50.0</td>
      <td>4</td>
      <td>11</td>
      <td>7</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18</td>
      <td>f</td>
      <td>31</td>
      <td>90</td>
      <td>95</td>
      <td>92.5</td>
      <td>89.5</td>
      <td>90.0</td>
      <td>86.0</td>
      <td>81.0</td>
      <td>89.0</td>
      <td>88.0</td>
      <td>10</td>
      <td>9</td>
      <td>3</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>22</td>
      <td>f</td>
      <td>35</td>
      <td>100</td>
      <td>75</td>
      <td>87.5</td>
      <td>89.5</td>
      <td>NaN</td>
      <td>71.0</td>
      <td>80.0</td>
      <td>88.0</td>
      <td>80.0</td>
      <td>13</td>
      <td>8</td>
      <td>20</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>f</td>
      <td>74</td>
      <td>60</td>
      <td>65</td>
      <td>62.5</td>
      <td>68.5</td>
      <td>49.0</td>
      <td>61.0</td>
      <td>49.0</td>
      <td>65.0</td>
      <td>49.0</td>
      <td>13</td>
      <td>9</td>
      <td>12</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>This data set is in tidy format. Each row represents a single test on a single participant. The aspects of that person’s test are given in each column. We already saw the power of having the data in this format when we did Boolean indexing in the last lesson. Now, we will see how this format allows use to easily do an operation we do again and again with data sets, <strong>split-apply-combine</strong>.</p>
</div>
<div class="section" id="Split-apply-combine">
<h2>Split-apply-combine<a class="headerlink" href="#Split-apply-combine" title="Permalink to this headline">¶</a></h2>
<p>Let’s say we want to compute the median percent correct face matchings for subjects with insomnia and the median percent correct face matchings for normal sleepers. Ignoring for the second the mechanics of how we would do this with Python, let’s think about it in English. What do we need to do?</p>
<ol class="arabic simple">
<li><p><strong>Split</strong> the data set up according to the <code class="docutils literal notranslate"><span class="pre">'insomnia'</span></code> field, i.e., split it up so we have a separate data set for the two classes of subjects, those with insomnia and those without.</p></li>
<li><p><strong>Apply</strong> a median function to the activity in these split data sets.</p></li>
<li><p><strong>Combine</strong> the results of these averages on the split data set into a new, summary data set that contains the two classes (insomniac and not) and medians for each.</p></li>
</ol>
<p>We see that the strategy we want is a <strong>split-apply-combine</strong> strategy. This idea was put forward by Hadley Wickham in <a class="reference external" href="http://dx.doi.org/10.18637/jss.v040.i01">this paper</a>. It turns out that this is a strategy we want to use <em>very</em> often. Split the data in terms of some criterion. Apply some function to the split-up data. Combine the results into a new data frame.</p>
<p>Note that if the data are tidy, this procedure makes a lot of sense. Choose the column you want to use to split by. All rows with like entries in the splitting column are then grouped into a new data set. You can then apply any function you want into these new data sets. You can then combine the results into a new data frame.</p>
<p>Pandas’s split-apply-combine operations are achieved using the <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> method. You can think of <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> as the splitting part. You can then apply functions to the resulting <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> object. The <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/groupby.html">Pandas documentation on split-apply-combine</a> is excellent and worth reading through. It is extensive though, so don’t let yourself get intimidated by it.</p>
<div class="section" id="Aggregation:-Median-percent-correct">
<h3>Aggregation: Median percent correct<a class="headerlink" href="#Aggregation:-Median-percent-correct" title="Permalink to this headline">¶</a></h3>
<p>Let’s go ahead and do our first split-apply-combine on this tidy data set. First, we will split the data set up by insomnia condition.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;insomnia&#39;</span><span class="p">)</span>

<span class="c1"># Take a look</span>
<span class="n">grouped</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7fa24c82f9d0&gt;
</pre></div></div>
</div>
<p>There is not much to see in the <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> object that resulted. But there is a lot we can do with this object. Typing <code class="docutils literal notranslate"><span class="pre">grouped.</span></code> and hitting tab will show you the many possibilities. For most of these possibilities, the apply and combine steps happen together and a new data frame is returned. The <code class="docutils literal notranslate"><span class="pre">grouped.median()</span></code> method is exactly what we want.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_median</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

<span class="c1"># Take a look</span>
<span class="n">df_median</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant number</th>
      <th>age</th>
      <th>correct hit percentage</th>
      <th>correct reject percentage</th>
      <th>percent correct</th>
      <th>confidence when correct hit</th>
      <th>confidence when incorrect hit</th>
      <th>confidence when correct reject</th>
      <th>confidence when incorrect reject</th>
      <th>confidence when correct</th>
      <th>confidence when incorrect</th>
      <th>sci</th>
      <th>psqi</th>
      <th>ess</th>
    </tr>
    <tr>
      <th>insomnia</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>54</td>
      <td>36</td>
      <td>90</td>
      <td>80</td>
      <td>85.0</td>
      <td>74.5</td>
      <td>55.5</td>
      <td>71.5</td>
      <td>59.0</td>
      <td>75.0</td>
      <td>59.25</td>
      <td>26</td>
      <td>4</td>
      <td>6</td>
    </tr>
    <tr>
      <th>True</th>
      <td>46</td>
      <td>39</td>
      <td>90</td>
      <td>75</td>
      <td>75.0</td>
      <td>76.5</td>
      <td>72.0</td>
      <td>71.0</td>
      <td>68.5</td>
      <td>77.0</td>
      <td>65.00</td>
      <td>14</td>
      <td>9</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The outputted data frame has the medians of all quantities, including the <code class="docutils literal notranslate"><span class="pre">percent</span> <span class="pre">correct</span></code> that we wanted. Note that this data frame has <code class="docutils literal notranslate"><span class="pre">insomnia</span></code> as the name of the row index. If we want to instead keep <code class="docutils literal notranslate"><span class="pre">insomnia</span></code> (which, remember, is what we used to split up the data set before we computed the summary statistics) as a column, we can use the <code class="docutils literal notranslate"><span class="pre">reset_index()</span></code> method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_median</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>insomnia</th>
      <th>participant number</th>
      <th>age</th>
      <th>correct hit percentage</th>
      <th>correct reject percentage</th>
      <th>percent correct</th>
      <th>confidence when correct hit</th>
      <th>confidence when incorrect hit</th>
      <th>confidence when correct reject</th>
      <th>confidence when incorrect reject</th>
      <th>confidence when correct</th>
      <th>confidence when incorrect</th>
      <th>sci</th>
      <th>psqi</th>
      <th>ess</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>False</td>
      <td>54</td>
      <td>36</td>
      <td>90</td>
      <td>80</td>
      <td>85.0</td>
      <td>74.5</td>
      <td>55.5</td>
      <td>71.5</td>
      <td>59.0</td>
      <td>75.0</td>
      <td>59.25</td>
      <td>26</td>
      <td>4</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>True</td>
      <td>46</td>
      <td>39</td>
      <td>90</td>
      <td>75</td>
      <td>75.0</td>
      <td>76.5</td>
      <td>72.0</td>
      <td>71.0</td>
      <td>68.5</td>
      <td>77.0</td>
      <td>65.00</td>
      <td>14</td>
      <td>9</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Note, though, that this was not done in-place. <code class="docutils literal notranslate"><span class="pre">df_median</span></code> still has an index labeled <code class="docutils literal notranslate"><span class="pre">'insomnia'</span></code>. If you want to update your data frame, you have to explicitly do so.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_median</span> <span class="o">=</span> <span class="n">df_median</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We can also use multiple columns in our <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> operation. For example, we may wish to look at four groups, male insomniacs, female insomniacs, male non-insomniacs, and female non-insomniacs. To do this, we simply pass in a list of columns into <code class="docutils literal notranslate"><span class="pre">df.groupby()</span></code>. We will <strong>chain the methods</strong>, performing a groupby, applying a median, and then resetting the index of the result, all in one line.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;insomnia&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>insomnia</th>
      <th>participant number</th>
      <th>age</th>
      <th>correct hit percentage</th>
      <th>correct reject percentage</th>
      <th>percent correct</th>
      <th>confidence when correct hit</th>
      <th>confidence when incorrect hit</th>
      <th>confidence when correct reject</th>
      <th>confidence when incorrect reject</th>
      <th>confidence when correct</th>
      <th>confidence when incorrect</th>
      <th>sci</th>
      <th>psqi</th>
      <th>ess</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>f</td>
      <td>False</td>
      <td>58.0</td>
      <td>36.0</td>
      <td>85.0</td>
      <td>80.0</td>
      <td>85.00</td>
      <td>74.00</td>
      <td>55.00</td>
      <td>70.50</td>
      <td>60.00</td>
      <td>74.00</td>
      <td>58.75</td>
      <td>26.0</td>
      <td>4.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>f</td>
      <td>True</td>
      <td>46.0</td>
      <td>39.0</td>
      <td>80.0</td>
      <td>75.0</td>
      <td>72.50</td>
      <td>76.50</td>
      <td>73.75</td>
      <td>71.00</td>
      <td>68.50</td>
      <td>77.00</td>
      <td>70.50</td>
      <td>14.0</td>
      <td>9.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>m</td>
      <td>False</td>
      <td>41.0</td>
      <td>38.5</td>
      <td>90.0</td>
      <td>80.0</td>
      <td>82.50</td>
      <td>76.00</td>
      <td>57.75</td>
      <td>74.25</td>
      <td>54.75</td>
      <td>76.25</td>
      <td>59.25</td>
      <td>29.0</td>
      <td>3.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>m</td>
      <td>True</td>
      <td>55.5</td>
      <td>37.0</td>
      <td>95.0</td>
      <td>82.5</td>
      <td>83.75</td>
      <td>83.75</td>
      <td>55.50</td>
      <td>75.75</td>
      <td>73.25</td>
      <td>81.25</td>
      <td>62.50</td>
      <td>14.0</td>
      <td>9.0</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>This type of operation is called an <strong>aggregation</strong>. That is, we split the data set up into groups, and then computed a summary statistic for each group, in this case the median.</p>
</div>
</div>
<div class="section" id="Transformation">
<h2>Transformation<a class="headerlink" href="#Transformation" title="Permalink to this headline">¶</a></h2>
<p>Instead of summarizing data in a group with single summary statistics by aggregation, we can also do a <strong>transformation</strong> in which each row gets a new entry within a given group. As a simple example, we could generate a column that gives the rank of each participate in terms of percent correct for an insomniac group versus non-insomniac groups. That is, we perform a rank ordering with the insomniac group and within the non-insomniac group.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;percent correct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0      11.0
1      21.5
2      23.0
3      19.5
4       3.5
5       2.0
6      17.0
7       6.0
8      21.5
9      12.5
10      3.5
11     24.0
12     15.0
13     15.0
14      5.0
15      8.5
16      8.5
17     15.0
18     18.0
19     12.5
20      8.5
21     25.0
22     19.5
23      1.0
24      8.5
25     15.0
26     41.0
27     19.0
28      9.5
29     72.0
       ...
72     52.5
73     74.0
74     67.5
75     76.0
76      4.5
77     72.0
78     25.0
79     25.0
80     34.0
81      1.0
82     52.5
83     41.0
84     52.5
85     25.0
86      6.5
87     15.0
88     41.0
89     67.5
90     41.0
91     15.0
92     61.0
93     61.0
94      2.0
95     52.5
96      4.5
97     25.0
98     52.5
99     19.0
100    11.5
101     6.5
Name: percent correct, Length: 102, dtype: float64
</pre></div></div>
</div>
<p>This gave us a column of ranks with the indexing of the original data frame preserved. We can put this column into the data frame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rank grouped by insomnia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;percent correct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>

<span class="c1"># Take a look</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant number</th>
      <th>gender</th>
      <th>age</th>
      <th>correct hit percentage</th>
      <th>correct reject percentage</th>
      <th>percent correct</th>
      <th>confidence when correct hit</th>
      <th>confidence when incorrect hit</th>
      <th>confidence when correct reject</th>
      <th>confidence when incorrect reject</th>
      <th>confidence when correct</th>
      <th>confidence when incorrect</th>
      <th>sci</th>
      <th>psqi</th>
      <th>ess</th>
      <th>insomnia</th>
      <th>rank grouped by insomnia</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8</td>
      <td>f</td>
      <td>39</td>
      <td>65</td>
      <td>80</td>
      <td>72.5</td>
      <td>91.0</td>
      <td>90.0</td>
      <td>93.0</td>
      <td>83.5</td>
      <td>93.0</td>
      <td>90.0</td>
      <td>9</td>
      <td>13</td>
      <td>2</td>
      <td>True</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16</td>
      <td>m</td>
      <td>42</td>
      <td>90</td>
      <td>90</td>
      <td>90.0</td>
      <td>75.5</td>
      <td>55.5</td>
      <td>70.5</td>
      <td>50.0</td>
      <td>75.0</td>
      <td>50.0</td>
      <td>4</td>
      <td>11</td>
      <td>7</td>
      <td>True</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18</td>
      <td>f</td>
      <td>31</td>
      <td>90</td>
      <td>95</td>
      <td>92.5</td>
      <td>89.5</td>
      <td>90.0</td>
      <td>86.0</td>
      <td>81.0</td>
      <td>89.0</td>
      <td>88.0</td>
      <td>10</td>
      <td>9</td>
      <td>3</td>
      <td>True</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>22</td>
      <td>f</td>
      <td>35</td>
      <td>100</td>
      <td>75</td>
      <td>87.5</td>
      <td>89.5</td>
      <td>NaN</td>
      <td>71.0</td>
      <td>80.0</td>
      <td>88.0</td>
      <td>80.0</td>
      <td>13</td>
      <td>8</td>
      <td>20</td>
      <td>True</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>f</td>
      <td>74</td>
      <td>60</td>
      <td>65</td>
      <td>62.5</td>
      <td>68.5</td>
      <td>49.0</td>
      <td>61.0</td>
      <td>49.0</td>
      <td>65.0</td>
      <td>49.0</td>
      <td>13</td>
      <td>9</td>
      <td>12</td>
      <td>True</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>To verify that this worked correctly, and also to show some nice sorting properties of data frames, we will sort the data frame by <code class="docutils literal notranslate"><span class="pre">insomnia</span></code> and then by <code class="docutils literal notranslate"><span class="pre">percent</span> <span class="pre">correct</span></code> and make sure the ranks worked accordingly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_sorted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;insomnia&#39;</span><span class="p">,</span> <span class="s1">&#39;percent correct&#39;</span><span class="p">])</span>

<span class="c1"># Look at relevant columns</span>
<span class="n">df_sorted</span><span class="p">[[</span><span class="s1">&#39;insomnia&#39;</span><span class="p">,</span> <span class="s1">&#39;percent correct&#39;</span><span class="p">,</span> <span class="s1">&#39;rank grouped by insomnia&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>insomnia</th>
      <th>percent correct</th>
      <th>rank grouped by insomnia</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81</th>
      <td>False</td>
      <td>40.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>94</th>
      <td>False</td>
      <td>55.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>39</th>
      <td>False</td>
      <td>57.5</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>76</th>
      <td>False</td>
      <td>60.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>False</td>
      <td>60.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>86</th>
      <td>False</td>
      <td>62.5</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>101</th>
      <td>False</td>
      <td>62.5</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>41</th>
      <td>False</td>
      <td>65.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>False</td>
      <td>67.5</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>50</th>
      <td>False</td>
      <td>67.5</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>34</th>
      <td>False</td>
      <td>70.0</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>100</th>
      <td>False</td>
      <td>70.0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>False</td>
      <td>72.5</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>52</th>
      <td>False</td>
      <td>72.5</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>53</th>
      <td>False</td>
      <td>72.5</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>87</th>
      <td>False</td>
      <td>72.5</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>91</th>
      <td>False</td>
      <td>72.5</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>False</td>
      <td>75.0</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>49</th>
      <td>False</td>
      <td>75.0</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>False</td>
      <td>75.0</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>36</th>
      <td>False</td>
      <td>77.5</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>43</th>
      <td>False</td>
      <td>77.5</td>
      <td>22.0</td>
    </tr>
    <tr>
      <th>51</th>
      <td>False</td>
      <td>77.5</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>64</th>
      <td>False</td>
      <td>77.5</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>68</th>
      <td>False</td>
      <td>77.5</td>
      <td>25.0</td>
    </tr>
    <tr>
      <th>78</th>
      <td>False</td>
      <td>77.5</td>
      <td>26.0</td>
    </tr>
    <tr>
      <th>79</th>
      <td>False</td>
      <td>77.5</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>85</th>
      <td>False</td>
      <td>77.5</td>
      <td>28.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>False</td>
      <td>77.5</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>False</td>
      <td>80.0</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>77</th>
      <td>False</td>
      <td>95.0</td>
      <td>73.0</td>
    </tr>
    <tr>
      <th>73</th>
      <td>False</td>
      <td>97.5</td>
      <td>74.0</td>
    </tr>
    <tr>
      <th>33</th>
      <td>False</td>
      <td>100.0</td>
      <td>75.0</td>
    </tr>
    <tr>
      <th>70</th>
      <td>False</td>
      <td>100.0</td>
      <td>76.0</td>
    </tr>
    <tr>
      <th>75</th>
      <td>False</td>
      <td>100.0</td>
      <td>77.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>True</td>
      <td>45.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>True</td>
      <td>50.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>True</td>
      <td>62.5</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>True</td>
      <td>62.5</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>True</td>
      <td>65.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>True</td>
      <td>67.5</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>True</td>
      <td>70.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>True</td>
      <td>70.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>True</td>
      <td>70.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>True</td>
      <td>70.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>True</td>
      <td>72.5</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>True</td>
      <td>75.0</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>True</td>
      <td>75.0</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>True</td>
      <td>80.0</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>True</td>
      <td>80.0</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>True</td>
      <td>80.0</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>True</td>
      <td>82.5</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>True</td>
      <td>85.0</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>True</td>
      <td>87.5</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>True</td>
      <td>87.5</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>True</td>
      <td>90.0</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>True</td>
      <td>90.0</td>
      <td>22.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>True</td>
      <td>92.5</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>True</td>
      <td>95.0</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>True</td>
      <td>97.5</td>
      <td>25.0</td>
    </tr>
  </tbody>
</table>
<p>102 rows × 3 columns</p>
</div></div>
</div>
<p>Indeed it worked!</p>
</div>
<div class="section" id="Aggregating-and-transforming-with-custom-functions">
<h2>Aggregating and transforming with custom functions<a class="headerlink" href="#Aggregating-and-transforming-with-custom-functions" title="Permalink to this headline">¶</a></h2>
<p>Let’s say we want to compute the coefficient of variation (CoV, the standard deviation divided by the mean) of data in columns of groups in the data frame. There is no built-in function to do this. We have to write our own function to compute the CoV and then use it with the <code class="docutils literal notranslate"><span class="pre">agg()</span></code> method of a <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> object. In the function below, the values of each column are denoted by <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p>
<p>To compute the coefficient of variation, we will use one more Numpy function beyond <code class="docutils literal notranslate"><span class="pre">np.mean()</span></code> that you have already seen, <code class="docutils literal notranslate"><span class="pre">np.std()</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">coeff_of_var</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute coefficient of variation from an array of data.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we can apply it as an aggregating function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">grouped</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">coeff_of_var</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant number</th>
      <th>age</th>
      <th>correct hit percentage</th>
      <th>correct reject percentage</th>
      <th>percent correct</th>
      <th>confidence when correct hit</th>
      <th>confidence when incorrect hit</th>
      <th>confidence when correct reject</th>
      <th>confidence when incorrect reject</th>
      <th>confidence when correct</th>
      <th>confidence when incorrect</th>
      <th>sci</th>
      <th>psqi</th>
      <th>ess</th>
    </tr>
    <tr>
      <th>insomnia</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>False</th>
      <td>0.586191</td>
      <td>0.384262</td>
      <td>0.166784</td>
      <td>0.184061</td>
      <td>0.138785</td>
      <td>0.195978</td>
      <td>0.350286</td>
      <td>0.204312</td>
      <td>0.298216</td>
      <td>0.187304</td>
      <td>0.262509</td>
      <td>0.175245</td>
      <td>0.577869</td>
      <td>0.571566</td>
    </tr>
    <tr>
      <th>True</th>
      <td>0.536117</td>
      <td>0.313853</td>
      <td>0.218834</td>
      <td>0.325760</td>
      <td>0.171856</td>
      <td>0.156219</td>
      <td>0.225440</td>
      <td>0.222827</td>
      <td>0.211512</td>
      <td>0.160061</td>
      <td>0.197484</td>
      <td>0.381907</td>
      <td>0.299741</td>
      <td>0.681514</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can take a similar approach with a transformation. In this case, we will actually do something useful. We will compute the <code class="docutils literal notranslate"><span class="pre">y</span></code>-values we need for plotting an <strong>empirical cumulative distribution function</strong> (ECDF), which we will use in our upcoming lessons with plotting. Briefly, an ECDF for a data set is defined as follows. The ECDF evaluated at <em>x</em> for a set of measurements is defined as</p>
<blockquote>
<div><p>ECDF(<em>x</em>) = fraction of measurements ≤ <em>x</em>.</p>
</div></blockquote>
<p>As you can convince yourself if you work it out, the <code class="docutils literal notranslate"><span class="pre">y</span></code>-values of an ECDF are the rankings of the entries, divided by the total number of entries. We will want to plot ECDFs for each group, so we apply the function for each group. First, we define the function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">ecdf_y</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Give y-values of an ECDF for an unsorted column in a data frame.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, we can compute the ECDF on the data set grouped by insomnia state.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ecdf_y grouped by insomnia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;percent correct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ecdf_y</span><span class="p">)</span>

<span class="c1"># Take a look</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>participant number</th>
      <th>gender</th>
      <th>age</th>
      <th>correct hit percentage</th>
      <th>correct reject percentage</th>
      <th>percent correct</th>
      <th>confidence when correct hit</th>
      <th>confidence when incorrect hit</th>
      <th>confidence when correct reject</th>
      <th>confidence when incorrect reject</th>
      <th>confidence when correct</th>
      <th>confidence when incorrect</th>
      <th>sci</th>
      <th>psqi</th>
      <th>ess</th>
      <th>insomnia</th>
      <th>rank grouped by insomnia</th>
      <th>ecdf_y grouped by insomnia</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8</td>
      <td>f</td>
      <td>39</td>
      <td>65</td>
      <td>80</td>
      <td>72.5</td>
      <td>91.0</td>
      <td>90.0</td>
      <td>93.0</td>
      <td>83.5</td>
      <td>93.0</td>
      <td>90.0</td>
      <td>9</td>
      <td>13</td>
      <td>2</td>
      <td>True</td>
      <td>11.0</td>
      <td>0.44</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16</td>
      <td>m</td>
      <td>42</td>
      <td>90</td>
      <td>90</td>
      <td>90.0</td>
      <td>75.5</td>
      <td>55.5</td>
      <td>70.5</td>
      <td>50.0</td>
      <td>75.0</td>
      <td>50.0</td>
      <td>4</td>
      <td>11</td>
      <td>7</td>
      <td>True</td>
      <td>21.0</td>
      <td>0.84</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18</td>
      <td>f</td>
      <td>31</td>
      <td>90</td>
      <td>95</td>
      <td>92.5</td>
      <td>89.5</td>
      <td>90.0</td>
      <td>86.0</td>
      <td>81.0</td>
      <td>89.0</td>
      <td>88.0</td>
      <td>10</td>
      <td>9</td>
      <td>3</td>
      <td>True</td>
      <td>23.0</td>
      <td>0.92</td>
    </tr>
    <tr>
      <th>3</th>
      <td>22</td>
      <td>f</td>
      <td>35</td>
      <td>100</td>
      <td>75</td>
      <td>87.5</td>
      <td>89.5</td>
      <td>NaN</td>
      <td>71.0</td>
      <td>80.0</td>
      <td>88.0</td>
      <td>80.0</td>
      <td>13</td>
      <td>8</td>
      <td>20</td>
      <td>True</td>
      <td>19.0</td>
      <td>0.76</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>f</td>
      <td>74</td>
      <td>60</td>
      <td>65</td>
      <td>62.5</td>
      <td>68.5</td>
      <td>49.0</td>
      <td>61.0</td>
      <td>49.0</td>
      <td>65.0</td>
      <td>49.0</td>
      <td>13</td>
      <td>9</td>
      <td>12</td>
      <td>True</td>
      <td>3.0</td>
      <td>0.12</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>You now have tremendous power in your hands. When your data are tidy, you can rapidly accelerate the ubiquitous split-apply-combine methods. Importantly, you now have a logical framework to think about how you slice and dice your data. As a final, simple example, I will show you how to go start to finish after loading the data set into a data frame, splitting by insomnia and gender, and then getting the quartiles and extrema, in addition to the mean and standard deviation, in the percent of
correct facial matchings.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;insomnia&#39;</span><span class="p">])[</span><span class="s1">&#39;percent correct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>gender</th>
      <th>insomnia</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">f</th>
      <th>False</th>
      <td>55.0</td>
      <td>82.045455</td>
      <td>10.844982</td>
      <td>55.0</td>
      <td>75.000</td>
      <td>85.00</td>
      <td>88.750</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>True</th>
      <td>19.0</td>
      <td>73.947368</td>
      <td>13.624829</td>
      <td>45.0</td>
      <td>67.500</td>
      <td>72.50</td>
      <td>83.750</td>
      <td>95.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">m</th>
      <th>False</th>
      <td>22.0</td>
      <td>80.000000</td>
      <td>12.770875</td>
      <td>40.0</td>
      <td>77.500</td>
      <td>82.50</td>
      <td>89.375</td>
      <td>95.0</td>
    </tr>
    <tr>
      <th>True</th>
      <td>6.0</td>
      <td>82.916667</td>
      <td>10.655593</td>
      <td>67.5</td>
      <td>76.875</td>
      <td>83.75</td>
      <td>88.750</td>
      <td>97.5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Yes, that’s right. One single, clean, easy to read line of code. In coming tutorials, we will see how to use tidy data to quickly generate plots.</p>
</div>
<div class="section" id="Looping-over-a-GroupBy-object">
<h2>Looping over a GroupBy object<a class="headerlink" href="#Looping-over-a-GroupBy-object" title="Permalink to this headline">¶</a></h2>
<p>While the <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> methods we have learned so far (like <code class="docutils literal notranslate"><span class="pre">transform()</span></code> and <code class="docutils literal notranslate"><span class="pre">agg()</span></code>) are useful and lead to concise code, we sometimes want to loop over the groups of a <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> object. This often comes up in plotting applications, as we will see in future lessons. As an example, I will compute the median percent correct for female and males, insomniacs and not (which we already computed using <code class="docutils literal notranslate"><span class="pre">describe()</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;insomnia&#39;</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;percent correct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;f&#39;, False) :  85.0
(&#39;f&#39;, True) :  72.5
(&#39;m&#39;, False) :  82.5
(&#39;m&#39;, True) :  83.75
</pre></div></div>
</div>
<p>By using the <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> object as an iterator, it yields the name of the group (which I assigned as <code class="docutils literal notranslate"><span class="pre">name</span></code>) and the corresponding sub-data frame (which I assigned <code class="docutils literal notranslate"><span class="pre">group</span></code>).</p>
</div>
<div class="section" id="Tidying-a-data-set">
<h2>Tidying a data set<a class="headerlink" href="#Tidying-a-data-set" title="Permalink to this headline">¶</a></h2>
<p>You should always organize your data sets in a tidy format. However, this is sometimes just not possible, since you data sets can come from instruments that do not output the data in tidy format (though most do, at least in my experience), and you often have collaborators that send data in untidy formats.</p>
<p>The most useful function for tidying data is <code class="docutils literal notranslate"><span class="pre">pd.melt()</span></code>. To demonstrate this, I will load in a data set from <a class="reference external" href="https://doi.org/10.1016/j.devcel.2011.12.007">this paper by Reeves, et al.</a> in which they measured the width of the gradient in the morphogen Dorsal in <em>Drosophila</em> embryos for various genotypes using different method. First, let’s load in the data set and take a look.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/reeves_gradient_width_various_methods.csv&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">wt</th>
      <th colspan="3" halign="left">dl1/+; dl-venus/+</th>
      <th colspan="3" halign="left">dl1/+; dl-gfp/+</th>
    </tr>
    <tr>
      <th></th>
      <th>wholemounts</th>
      <th>cross-sections</th>
      <th>anti-Dorsal</th>
      <th>anti-Venus</th>
      <th>Venus (live)</th>
      <th>anti-Dorsal</th>
      <th>anti-GFP</th>
      <th>GFP (live)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.1288</td>
      <td>0.1327</td>
      <td>0.1482</td>
      <td>0.1632</td>
      <td>0.1666</td>
      <td>0.2248</td>
      <td>0.2389</td>
      <td>0.2412</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.1554</td>
      <td>0.1457</td>
      <td>0.1503</td>
      <td>0.1671</td>
      <td>0.1753</td>
      <td>0.1891</td>
      <td>0.2035</td>
      <td>0.1942</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.1306</td>
      <td>0.1447</td>
      <td>0.1577</td>
      <td>0.1704</td>
      <td>0.1705</td>
      <td>0.1705</td>
      <td>0.1943</td>
      <td>0.2186</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.1413</td>
      <td>0.1282</td>
      <td>0.1711</td>
      <td>0.1779</td>
      <td>NaN</td>
      <td>0.1735</td>
      <td>0.2000</td>
      <td>0.2104</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.1557</td>
      <td>0.1487</td>
      <td>0.1342</td>
      <td>0.1483</td>
      <td>NaN</td>
      <td>0.2135</td>
      <td>0.2560</td>
      <td>0.2463</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As is often the case with spreadsheets, we have a <strong>multiindex</strong>, where we have two methods for wild type, three for Venus, and three for GFP. The rows here have no meaning. Clearly these data are not tidy.</p>
<p>When we melt the data frame, the data within it, called <strong>values</strong>, become a single column. The headers, called <strong>variables</strong>, also become new columns. So, to melt it, we need to specify what we want to call the values and what we want to call the variable. <code class="docutils literal notranslate"><span class="pre">pd.melt()</span></code> does the rest!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;gradient width&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;genotype&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>genotype</th>
      <th>method</th>
      <th>gradient width</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>wt</td>
      <td>wholemounts</td>
      <td>0.1288</td>
    </tr>
    <tr>
      <th>1</th>
      <td>wt</td>
      <td>wholemounts</td>
      <td>0.1554</td>
    </tr>
    <tr>
      <th>2</th>
      <td>wt</td>
      <td>wholemounts</td>
      <td>0.1306</td>
    </tr>
    <tr>
      <th>3</th>
      <td>wt</td>
      <td>wholemounts</td>
      <td>0.1413</td>
    </tr>
    <tr>
      <th>4</th>
      <td>wt</td>
      <td>wholemounts</td>
      <td>0.1557</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Nice! We now have a tidy data frame. The only problem is that it has many NaNs because there were many of them in the data set. We can now safely delete any row that has a NaN.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>…and we are good to do with a tidy DataFrame! Let’s take a look at the summary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;genotype&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="8" halign="left">gradient width</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>genotype</th>
      <th>method</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">dl1/+; dl-gfp/+</th>
      <th>GFP (live)</th>
      <td>6.0</td>
      <td>0.218783</td>
      <td>0.021052</td>
      <td>0.1942</td>
      <td>0.204100</td>
      <td>0.21450</td>
      <td>0.235550</td>
      <td>0.2463</td>
    </tr>
    <tr>
      <th>anti-Dorsal</th>
      <td>20.0</td>
      <td>0.198300</td>
      <td>0.024468</td>
      <td>0.1640</td>
      <td>0.177625</td>
      <td>0.19540</td>
      <td>0.213775</td>
      <td>0.2516</td>
    </tr>
    <tr>
      <th>anti-GFP</th>
      <td>20.0</td>
      <td>0.226120</td>
      <td>0.024664</td>
      <td>0.1934</td>
      <td>0.203950</td>
      <td>0.22620</td>
      <td>0.241550</td>
      <td>0.2682</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">dl1/+; dl-venus/+</th>
      <th>Venus (live)</th>
      <td>3.0</td>
      <td>0.170800</td>
      <td>0.004358</td>
      <td>0.1666</td>
      <td>0.168550</td>
      <td>0.17050</td>
      <td>0.172900</td>
      <td>0.1753</td>
    </tr>
    <tr>
      <th>anti-Dorsal</th>
      <td>29.0</td>
      <td>0.160490</td>
      <td>0.010805</td>
      <td>0.1342</td>
      <td>0.154600</td>
      <td>0.16010</td>
      <td>0.170100</td>
      <td>0.1773</td>
    </tr>
    <tr>
      <th>anti-Venus</th>
      <td>29.0</td>
      <td>0.173031</td>
      <td>0.008742</td>
      <td>0.1483</td>
      <td>0.170100</td>
      <td>0.17390</td>
      <td>0.178000</td>
      <td>0.1902</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">wt</th>
      <th>cross-sections</th>
      <td>152.0</td>
      <td>0.148458</td>
      <td>0.016141</td>
      <td>0.1014</td>
      <td>0.136725</td>
      <td>0.14695</td>
      <td>0.159925</td>
      <td>0.1805</td>
    </tr>
    <tr>
      <th>wholemounts</th>
      <td>24.0</td>
      <td>0.145279</td>
      <td>0.019059</td>
      <td>0.1096</td>
      <td>0.130450</td>
      <td>0.14460</td>
      <td>0.158200</td>
      <td>0.1779</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can immediately see that the wild type has a narrower gradient than Venus, which is narrower still than GFP.</p>
</div>
<div class="section" id="Computing-environment">
<h2>Computing environment<a class="headerlink" href="#Computing-environment" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> watermark
<span class="o">%</span><span class="k">watermark</span> -v -p numpy,pandas,jupyterlab
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPython 3.7.7
IPython 7.15.0

numpy 1.18.1
pandas 0.24.2
jupyterlab 2.1.4
</pre></div></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="l16_plotting.html" class="btn btn-neutral float-right" title="Lesson 16: Making plots" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="l14_intro_to_pandas.html" class="btn btn-neutral float-left" title="Lesson 14: Introduction to Pandas" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Aug 19, 2021.
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-65442910-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>